# Zero Agent - VPS Integration Configuration
#
# Use this when deploying alongside existing services on do-vps-prod
# Add to existing docker-compose.yml or run separately
#
# Usage:
#   1. Copy to VPS: /opt/do-vps-prod/docker/droplet/
#   2. Add zero-agent entry to Caddyfile
#   3. docker compose -f docker-compose.yml -f docker-compose.zero-agent.yml up -d

services:
  zero-agent:
    image: ghcr.io/iamsamuelrodda/zero-agent:latest  # Or build locally
    # build:
    #   context: /opt/zero-agent
    #   dockerfile: Dockerfile
    container_name: zero-agent
    restart: unless-stopped
    networks:
      - frontend
    volumes:
      - zero-agent-data:/app/data
    environment:
      - NODE_ENV=production
      - PORT=3000
      - DATABASE_PROVIDER=sqlite
      - DATABASE_PATH=/app/data/zero-agent.db
      - ANTHROPIC_API_KEY=${ZERO_AGENT_ANTHROPIC_KEY}
      - XERO_CLIENT_ID=${ZERO_AGENT_XERO_CLIENT_ID}
      - XERO_CLIENT_SECRET=${ZERO_AGENT_XERO_CLIENT_SECRET}
      - BASE_URL=https://${ZERO_AGENT_DOMAIN:-zero.rodda.xyz}
      - FRONTEND_URL=https://${ZERO_AGENT_DOMAIN:-zero.rodda.xyz}
    deploy:
      resources:
        limits:
          memory: 384M  # Conservative limit for 1-3 users
          cpus: '0.5'   # Half a CPU core
        reservations:
          memory: 128M
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  zero-agent-data:
    name: zero-agent-data

# Network should already exist from main docker-compose.yml
networks:
  frontend:
    external: true
